@use "sass:map";

@function scale-down($values, $key) {
    @return calc(map.get($values, $key) / map.get($scale-factors, $key))
}

@function scale-data($values, $is-moon: null) {
    $colour: rgb(255, 255, 255);

    @if map-has-key($map: $values, $key: "colour") {
        $colour: #{map.get($values, "colour")}
    }

    $radius: scale-down($values, "radius");
    $distance: scale-down($values, "distance");
    $period: scale-down($values, "period");

    @if $is-moon {
        $radius: calc($radius * map.get($moon-weightings, "radius"));
        $distance: calc($distance * map.get($moon-weightings, "distance"));
        $period: calc($period * map.get($moon-weightings, "period"))
    }

    $retrograde: false;
    @if map-has-key($values, "retrograde") {
        $retrograde: map.get($values, "retrograde")
    }

    @return (radius: $radius,
        distance: $distance,
        period: $period,
        colour: $colour,
        retrograde: $retrograde)
}

@mixin tooltip($name, $data) {
    content: "#{$name}";
    color: #{map.get($data, "colour")};
    position: absolute;
    left: 100%;
    padding: 0.2rem;
    font-size: 0.8rem;

    display: none;
}

@mixin celestial-body($name, $data) {
    width: calc(map.get($data, "radius") * 2) + vw;
    animation: orbit-#{$name} #{map.get($data, "period")}s linear infinite;
    background-color: #{map.get($data, "colour")};
}

@mixin orbit($data, $additional-radius) {
    $distance: map.get($data, "distance");
    $first-angle: -360;
    $second-angle: 360;

    @if map.get($data, "retrograde") {
        $first-angle: 360;
        $second-angle: -360;
    }

    0% {
        transform: rotate(0deg) translateX(#{calc($distance + $additional-radius)} + vw) rotate(0deg);
    }

    100% {
        transform: rotate(#{$first-angle}deg) translateX(#{calc($distance + $additional-radius)} + vw) 
        rotate(#{$second-angle}deg);
}
}

@mixin orbital-mechanics($orbiter, $values, $parent: null) {
    $data: scale-data($values, $parent);

    $additional-radius: 0;

    @if $parent {
        $additional-radius: calc(map.get(scale-data(map.get($planets, $parent)), "radius") + map.get($moon-weightings, "fudge"));
    }


    ##{$orbiter} {
        @include celestial-body($orbiter, $data)
    }

    @keyframes orbit-#{$orbiter} {
        @include orbit($data, $additional-radius)
    }

    ##{$orbiter}::after {
        @include tooltip($orbiter, $data)
    }
}

html:has(#show-names:hover) *::after {
    display: block
}

// https://css-tricks.com/the-current-state-of-styling-scrollbars-in-css/
@mixin scrollbars($size: 0.5vw,
    $foreground-color: map.get($planets, uranus, "colour"),
    $background-color: black) {

    // For Chrome & Safari
    &::-webkit-scrollbar {
        width: $size;
        height: $size;
    }

    &::-webkit-scrollbar-thumb {
        background: $foreground-color;
    }

    &::-webkit-scrollbar-track {
        background: $background-color;
    }

    // Standard version (Firefox only for now)
    scrollbar-color: $foreground-color $background-color;
}